<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Test token</title>    
</head>
<body>
    <div id="regist_token">
        <h1>Get and Store Token</h1>
        <button onclick="check_token()">Store Token</button>
    </div>
    <div id="attend_token">
        <h1>Submit Token</h1>
        <button onclick="submit_token()">Check Token</button> <br />
        <button onclick="httpGet()">GET Token</button> <br />
        <button onclick="httpPost()">POST Token</button> <br />
    </div>
    <button onclick="reset_token()">Clear Token</button>

    <script type="text/javascript">        
        let token = localStorage.getItem("token");
        if (token == null || token == "") {
            document.getElementById('regist_token').style.visibility = 'visible';
            document.getElementById('attend_token').style.visibility = 'hidden';
        } else {
            document.getElementById('regist_token').style.visibility = 'hidden';
            document.getElementById('attend_token').style.visibility = 'visible';
        };
        function check_token() {
            //Gen token
            localStorage.setItem("token", "ZD11736");   //Store
            alert("Store Token");
        };
        function submit_token() {
            alert(token);
        };
        function reset_token() { localStorage.clear(); };
        function httpGet() {
            var headUrl = getQueryVariable("id") + token;
            //var theUrl = 'https://htmltestcros.azurewebsites.net/api/TAstamp?id=' + headUrl;
            //window.location.replace(theUrl);
            fetch('https://htmltestcros.azurewebsites.net/api/TAstamp?id=' + headUrl)
                .then(response => response.text())
                .then(data => console.log(data))
                .catch(error => console.error('Error:', error));
        };
        function httpPost() {
            fetch('https://htmltestcros.azurewebsites.net/api/TAstamp', {
                method: 'POST',
                headers: {'Content-Type': 'application/text'},
                body: 'YouTube385920',
            })
            .then(response => response.text())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        };
        function getQueryVariable(variable) {
            const query = window.location.search.substring(1);
            const vars = query.split("&");
            for (let i = 0; i < vars.length; i++) {
                const pair = vars[i].split("=");
                if (pair[0] === variable) { return pair[1]; };
            };
        };
    </script>
</body>
</html>